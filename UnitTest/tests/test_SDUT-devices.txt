defmod test_SDUT_devices UnitTest dummyDuino ( 
{
	## for online testsytem: defmod test_SDUT_devices UnitTest dummyDuino ##
	my %devices = (
		"Buttons_five_E" =>  {	"DEF"        => "Buttons_five E",
														"rmsg"       => "MU;P0=250;P1=-492;P2=166;P3=-255;P4=491;P5=-8588;D=052121212121234121212121234521212121212341212121212345212121212123412121212123452121212121234121212121234;CP=0;",
														"state"      => "fan_off",
														"deviceCode" => "1110 (off|off|off|on)",
														"model"      => "Buttons_five"
										},
		"CAME_TOP_432EV_EE" =>  {	"DEF"        => "CAME_TOP_432EV EE",
															"rmsg"       => "MU;P0=-322;P1=136;P2=-15241;P3=288;P4=-735;P6=723;D=0123434343064343430643434306234343430643434306434343062343434306434343064343430623434343064343430643434306234343430643434306434343062343434306434343064343430623434343064343430643434306234343430643434306434343062343434306434343064343430;CP=3;R=27;",
															"state"	     => "left_button",
															"deviceCode" => "11101110",
															"model"      => "CAME_TOP_432EV"
										},
		"Chilitec_22640_AA80" =>  {	"DEF"   => "Chilitec_22640 AA80",
																"rmsg"  => "MS;P0=988;P1=-384;P2=346;P3=-1026;P4=-4923;D=240123012301230123012323232323232301232323;CP=2;SP=4;R=0;O;m=1;",
																"state"	=> "power_on",
																"model" => "Chilitec_22640"
										},
		"HS1_868_BS_F62A9C01C" =>  {	"DEF"        => "HS1_868_BS F62A9C01C",
																	"rmsg"       => "MU;P0=-578;P1=1033;P2=506;P3=-1110;P4=13632;D=0101010232323101040101010101010101023232323102323101010231023102310231010232323101010101010101010232323101040101010101010101023232323102323101010231023102310231010232323101010101010101010232323101040101010101010101023232323102323101010231023102310231010;CP=2;R=77;",
																	"state"	     => "receive",
																	"deviceCode" => "1111011000101010100111000000",
																	"model"      => "HS1_868_BS"
										},
		"HSM4_E6BE910" =>  {	"DEF"        => "HSM4 E6BE910",
													"rmsg"       => "MU;P0=-508;P1=1029;P2=503;P3=-1023;P4=12388;D=01010232323232310104010101010101010102323231010232310231023232323231023101023101010231010101010232323232310104010101010101010102323231010232310231023232323231023101023101010231010101010232323232310104010101010101010102323231010232310231023232323231023101;CP=2;R=37;O;",
													"state"	     => "button_1",
													"deviceCode" => "1110011010111110100100010000",
													"model"      => "HSM4"
										},
		"KL_RF01_16F6" =>  {	"DEF"        => "KL_RF01 16F",
													"rmsg"       => "MS;P1=376;P4=-1200;P5=1170;P6=-409;P7=-12224;D=17141414561456561456565656145656141414145614141414565656145656565614;CP=1;SP=7;R=231;e;m0;",
													"state"	     => "light_color_cold_white",
													"deviceCode" => "0001011011110110",
													"model"      => "KL_RF01"
										},
		"Krinner_LUMIX_A06C360" =>  {	"DEF"        => "Krinner_LUMIX A06C360",
																	"rmsg"       => "MU;P0=11076;P1=-20524;P2=281;P3=-980;P4=982;P5=-411;P6=408;P7=-10156;D=0123232345456345456363636363636363634745634563636363636345456345456363636345456345456363636363636363634745634563636363636345456345456363636345456345456363636363636363634745634563636363636345456345456363636345456345456363636363636363634;CP=6;R=38;",
																	"state"	     => "off",
																	"deviceCode" => "1010000001101100001101100000",
																	"model"      => "Krinner_LUMIX"
										},
		"LED_XM21_0_FFFFFFFFFFFFFF" =>  {	"DEF"        => "LED_XM21_0 FFFFFFFFFFFFFF",
																			"rmsg"       => "MU;P0=-203;P1=412;P2=114;D=01010101020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020101010102020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020200;CP=2;R=74;",
																			"state"	     => "off",
																			"deviceCode" => "11111111111111111111111111111111111111111111111111111111",
																			"model"      => "LED_XM21_0"
										},
		"MD_2003R_FCC17E" =>  {	"DEF"       => "MD_2003R FCC17E",
														"rmsg"      => "MU;P0=-164;P1=378;P2=-813;P3=-429;P4=764;P5=-3929;D=0121212134342121343434343421342121212121213434343421212134342134213451212121212121343421213434343434213421212121212134343434212121343421342134512121212121213434212134343434342134212121212121343434342121213434213421345121212121212134342121343434343421342;CP=1;R=0;O;",
														"state"	    => "normal",
														"deviceTyp" => "gas",
														"ToDo"      => "added to JSON and recheck",
														"model"      => "MD_2003R"
													},
		"MD_2018R_803066" =>  {	"DEF"       => "MD_2018R 803066",
														"rmsg"      => "MU;P0=-817;P1=406;P2=-415;P3=813;P5=-4068;CP=3;D=01232323232323232323010123232323230101232301012323012323230123230123010151012323232323232323230101232323232301012323010123230123232301232301230101510123232323232323232301012323232323010123230101232301232323012323012301015101232323232323232323010123232323;O;",
														"state"	    => "warning",
														"contact"   => "Alarm",
														"deviceTyp" => "vibration",
														"model"      => "MD_2018R"
										},
		"MD_210R_91DF4F" =>  {	"DEF"       => "MD_210R 91DF4F",
														"rmsg"      => "MU;P1=392;P2=-416;P3=804;P4=-822;P5=-4029;P6=-32001;D=151412323412323234141412341414141412341232341414141234123234141412341234141660;CP=1;R=0;",
														"state"	    => "warning",
														"contact"   => "open",
														"deviceTyp" => "switch",
														"model"      => "MD_210R"
										},
		"Novy_840029_55" =>  {	"DEF"        => "Novy_840029 55",
														"rmsg"       => "MU;P0=-8032;P1=364;P2=-398;P3=700;P4=-760;P5=-15980;D=0123412341234123412341412351234123412341234123414123512341234123412341234141235123412341234123412341412351234123412341234123414123;CP=1;R=40;",
														"state"	     => "speed_minus",
														"deviceCode" => "01010101",
														"model"      => "Novy_840029"
													},
		"QUIGG_DMV_9E4" =>  {	"DEF"        => "QUIGG_DMV 9E4",
													"rmsg"       => "MU;P0=-9812;P1=589;P2=-671;P3=1261;P4=-1320;D=012341412323232341412341412323232323232323;CP=3;R=19;",
													"state"	     => "Ch1_off",
													"deviceCode" => "100111100100",
													"model"      => "QUIGG_DMV"
												},
		"RC_10_7869_A" =>  {	"DEF"        => "RC_10 7869_A",
													"rmsg"       => "MS;P1=790;P2=-363;P3=257;P4=-896;P5=-10283;D=35341212121234343434121234123434123434343412121234343412343412343434;CP=3;SP=5;O;m2;C;C;",
													"state"	     => "off",
													"deviceCode" => "0111100001101001",
													"LastAction" => "receive",
													"model"      => "RC_10"
												},
		"RC_10_7869_all" =>  {	"DEF"        => "RC_10 7869_all",
														"rmsg"       => "MS;P1=-363;P2=789;P3=267;P4=-887;P5=-10332;D=35342121212134343434212134213434213434343421343434343421343434212134;CP=3;SP=5;O;m2;4;",
														"state"	     => "off",
														"deviceCode" => "0111100001101001",
														"LastAction" => "receive",
														"x_n4"       => "0000",
														"x_n5-8_off" => "1000001000110",
														"x_n5-8_on"  => "0100001010110",
														"model"      => "RC_10"
													},
		"RH787T_0" =>  {	"DEF"        => "RH787T 0",
											"rmsg"       => "MS;P1=790;P2=-363;P3=257;P4=-896;P5=-10283;D=35341212121234343434121234123434123434343412121234343412343412343434;CP=3;SP=5;O;m2;C;C;",
											"state"	     => "1_fan_minimum_speed",
											"deviceCode" => "0000 (on|on|on|on)",
											"model"      => "RH787T"
										},
		"SA_434_1_mini_604" =>  {	"DEF"   => "SA_434_1_mini 604",
															"rmsg"  => "MU;P0=436;P1=-1033;P3=-537;P4=966;P5=-17209;P6=-7015;D=010103434343434341034345034101034343434343410343450341010343434343434103434506;CP=4;R=58;",
															"state" => "receive",
															"model" => "SA_434_1_mini"
										},
		"SF01_01319004_A150" =>  {	"DEF"        => "SF01_01319004 A150",
																"rmsg"       => "MU;P0=-707;P1=332;P2=-376;P3=670;P5=-15243;D=01012301232323230123012301232301010123510123012323232301230123012323010101235101230123232323012301230123230101012351012301232323230123012301232301010123510123012323232301230123012323010101235101230123232323012301230123230101012351012301232323230123012301;CP=1;R=3;O;",
																"state"	     => "light_on_off",
																"deviceCode" => "A150",
																"ToDo"       => "added to JSON and recheck",
																"model"      => "SF01_01319004"
															},
		"SF01_01319004_Typ2_2638" =>  {	"DEF"        => "SF01_01319004_Typ2 2638",
																		"rmsg"       => "MU;P0=706;P1=-160;P2=140;P3=-335;P4=-664;P5=385;P6=-15226;P7=248;D=01210103045303045453030304545453030454530653030453030454530303045454530304747306530304530304545303030454545303045453065303045303045453030304545453030454530653030453030454530303045454530304545306530304530304545303030454545303045453065303045303045453030304;CP=5;O;",
																		"state"	     => "light_on_off",
																		"deviceCode" => "2638",
																		"model"      => "SF01_01319004_Typ2"
																	},
		"TR_502MSV_FF" =>  {	"DEF"     => "TR_502MSV FF",
													"rmsg"    => "MU;P0=4192;P1=-663;P2=1325;P3=-1320;P4=668;P5=-9905;D=01212121212121212121212121212123412121234541212121212121212121212121212123412121234541212121212121212121212121212123412121234541212121212121212121212121212123412121234541212121212121212121212121212123412121234541212121212121212121212121212123412121234541;CP=2;R=71;O;",
													"state"   => "Ch1_on",
													"ToDo"    => "added to JSON and recheck",
													"model"   => "TR_502MSV"
												},
		"Techmar_7709F5DE" =>  {	"DEF"        => "Techmar 7709F5DE",
															"rmsg"       => "MU;P0=-972;P1=526;P2=-335;P3=-666;D=01213131312131313121212121312121313131313121312131313121313131312121212121312121313131313121313121212101213131312131313121212121312121313131313121312131313121313131312121212121312121313131313121313121212101213131312131313121212121312121313131313121312131;CP=1;R=44;O;",
															"state"      => "Group_1_on",
															"deviceCode" => "7709F5DE",
															"LastAction" => "receive",
															"model"      => "Techmar"
														},
		"Tedsen_SKX2xx_1F10110" =>  {	"DEF"          => "Tedsen_SKX2xx 1F10110",
																	"rmsg"         => "MU;P0=-2009;P1=2076;P2=-259;P3=329;P4=-15751;P5=1216;D=012121212303012303034121212301212303012121212303012303034121212301212303012121212303012303034121212305;CP=3;R=37;",
																	"state"        => "Button_1",
																	"tristateCode" => "1F10110F0",
																	"model"        => "Tedsen_SKX2xx"
																},
		"Tedsen_SKX6xx_1F10FF0" =>  {	"DEF"          => "Tedsen_SKX6xx 1F10FF0",
																	"rmsg"         => "MU;P0=-32001;P1=2072;P2=-260;P3=326;P4=-2015;P5=-15769;D=01212123412123434123412343434123412151212123412123434123412343434123412151212123412123434123412343434123412151212123412123434123412343434123412151212123412123434123412343434123412151212123412123434123412343434123412151212123412123434123412343434123412151;CP=3;R=37;O;",
																	"state"        => "Button_6",
																	"tristateCode" => "1F10FF0F1",
																	"model"        => "Tedsen_SKX6xx"
																},
		"Unitec_47031_95" =>  {	"DEF"   => "Unitec_47031 95",
														"rmsg"  => "MU;P0=309;P1=636;P2=-690;P3=-363;P4=-10027;D=012031203120402031312031203120312031204020313120312031203120312040203131203120312031203120402031312031203120312031204020313120312031203120312040203131203120312031203120402031312031203120312031204020313120312031203120312040203131203120312030;CP=0;O;",
														"state" => "1",
														"Zone"  => "010 (off|on|off) - Zone 3",
														"ToDo"  => "added to JSON and recheck",
														"model" => "Unitec_47031"
													},
	);
	
	for my $dev (sort keys %devices) {
		subtest "Checking $dev" => sub {
			my $plan = 0;

			for my $key (keys %{$devices{$dev}}) {
				#note($key);
				$plan++ if ($key ne "DEF" && $key ne "rmsg" && $key ne "ToDo" && $key ne "model");
			}
			
			plan => $plan;

			if(defined($defs{$dev}) && $defs{$dev}{TYPE} eq "SD_UT" && $defs{$dev}{NAME} eq $dev) {
				note("device is already defined on system");
				CommandSetReading(undef, "$dev state missing");
				#CommandDelete(undef,$dev);
			} else {
				note("device must defined");
				CommandDefMod(undef,"-temporary $dev SD_UT ".$devices{$dev}{DEF});			
			}

			my %signal_parts = SIGNALduino_Split_Message($devices{$dev}{rmsg},$targetHash->{NAME});
			SIGNALduino_Parse($targetHash, $targetHash, $targetHash->{NAME}, "\002".$devices{$dev}{rmsg}."\003");
			
			## all readings, if ne DEF,rmsg,ToDo ##
			for my $key (keys %{$devices{$dev}}) {
				#note($key);
				is(ReadingsVal($dev ,$key,"0"),$devices{$dev}{$key},"check reading $key") if ($key ne "DEF" && $key ne "rmsg" && $key ne "ToDo" && $key ne "model");
			}

			TODO: {
				# read from internal STATE, if FHEM restart -> defined, after dispatch must changed !!
				is(InternalVal($dev ,"STATE","0"),$devices{$dev}{state},"check internal state");
			}

			note("--> ToDo: ".$devices{$dev}{ToDo}." <--") if ($devices{$dev}{ToDo});
			sleep 3;
		};
		note("----------------------------------------- #");
	}
}
)